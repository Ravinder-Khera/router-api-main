import { Protocol } from '@uniswap/router-sdk';
import { log, } from '@uniswap/smart-order-router';
import { S3 } from 'aws-sdk';
import NodeCache from 'node-cache';
import { S3_POOL_CACHE_KEY } from '../../util/pool-cache-key';
const POOL_CACHE = new NodeCache({ stdTTL: 240, useClones: false });
const LOCAL_POOL_CACHE_KEY = (chainId, protocol) => `pools${chainId}#${protocol}`;
export class AWSSubgraphProvider {
    constructor(chain, protocol, bucket, baseKey) {
        this.chain = chain;
        this.protocol = protocol;
        this.bucket = bucket;
        this.baseKey = baseKey;
    }
    async getPools() {
        log.info(`In new AWS subgraph provider for protocol ${this.protocol}`);
        const cachedPools = POOL_CACHE.get(LOCAL_POOL_CACHE_KEY(this.chain, this.protocol));
        if (cachedPools) {
            log.info({ subgraphPoolsSample: cachedPools.slice(0, 5) }, `Subgraph pools fetched from local cache for protocol ${this.protocol}. Num: ${cachedPools.length}`);
            return cachedPools;
        }
        log.info({ bucket: this.bucket, key: this.baseKey }, `Subgraph pools local cache miss for protocol ${this.protocol}. Getting subgraph pools from S3`);
        const s3 = new S3();
        const pools = await cachePoolsFromS3(s3, this.bucket, this.baseKey, this.chain, this.protocol);
        return pools;
    }
}
export const cachePoolsFromS3 = async (s3, bucket, baseKey, chainId, protocol) => {
    const key = S3_POOL_CACHE_KEY(baseKey, chainId, protocol);
    let result;
    try {
        result = await s3.getObject({ Key: key, Bucket: bucket }).promise();
    }
    catch (err) {
        log.error({ bucket, key, err }, `Failed to get pools from S3 for ${protocol} on chain ${chainId}`);
        throw new Error(`Failed to get pools from S3 for ${protocol} on chain ${chainId}`);
    }
    const { Body: poolsBuffer } = result;
    if (!poolsBuffer) {
        throw new Error(`Could not get subgraph pool cache from S3 for protocol ${protocol} on chain ${chainId}`);
    }
    const pools = JSON.parse(poolsBuffer.toString('utf-8'));
    log.info({ bucket, key }, `Got subgraph pools from S3 for protocol ${protocol} on ${chainId}. Num: ${pools.length}`);
    POOL_CACHE.set(LOCAL_POOL_CACHE_KEY(chainId, protocol), pools);
    return pools;
};
export class V3AWSSubgraphProvider extends AWSSubgraphProvider {
    constructor(chainId, bucket, baseKey) {
        super(chainId, Protocol.V3, bucket, baseKey);
    }
    static async EagerBuild(bucket, baseKey, chainId) {
        const s3 = new S3();
        await cachePoolsFromS3(s3, bucket, baseKey, chainId, Protocol.V3);
        return new V3AWSSubgraphProvider(chainId, bucket, baseKey);
    }
}
export class V2AWSSubgraphProvider extends AWSSubgraphProvider {
    constructor(chainId, bucket, key) {
        super(chainId, Protocol.V2, bucket, key);
    }
    static async EagerBuild(bucket, baseKey, chainId) {
        const s3 = new S3();
        await cachePoolsFromS3(s3, bucket, baseKey, chainId, Protocol.V2);
        return new V2AWSSubgraphProvider(chainId, bucket, baseKey);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXdzLXN1YmdyYXBoLXByb3ZpZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vbGliL2hhbmRsZXJzL3JvdXRlci1lbnRpdGllcy9hd3Mtc3ViZ3JhcGgtcHJvdmlkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHFCQUFxQixDQUFBO0FBQzlDLE9BQU8sRUFHTCxHQUFHLEdBR0osTUFBTSw2QkFBNkIsQ0FBQTtBQUNwQyxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sU0FBUyxDQUFBO0FBRTVCLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQTtBQUU3RCxNQUFNLFVBQVUsR0FBRyxJQUFJLFNBQVMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUE7QUFDbkUsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLE9BQWdCLEVBQUUsUUFBa0IsRUFBRSxFQUFFLENBQUMsUUFBUSxPQUFPLElBQUksUUFBUSxFQUFFLENBQUE7QUFFcEcsTUFBTSxPQUFPLG1CQUFtQjtJQUM5QixZQUFvQixLQUFjLEVBQVUsUUFBa0IsRUFBVSxNQUFjLEVBQVUsT0FBZTtRQUEzRixVQUFLLEdBQUwsS0FBSyxDQUFTO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxZQUFPLEdBQVAsT0FBTyxDQUFRO0lBQUcsQ0FBQztJQUU1RyxLQUFLLENBQUMsUUFBUTtRQUNuQixHQUFHLENBQUMsSUFBSSxDQUFDLDZDQUE2QyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQTtRQUV0RSxNQUFNLFdBQVcsR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFrQixvQkFBb0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxR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aUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUVqRixPQUFPLElBQUkscUJBQXFCLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQTtJQUM1RCxDQUFDO0NBQ0Y7QUFFRCxNQUFNLE9BQU8scUJBQXNCLFNBQVEsbUJBQW1DO0lBQzVFLFlBQVksT0FBZ0IsRUFBRSxNQUFjLEVBQUUsR0FBVztRQUN2RCxLQUFLLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQzFDLENBQUM7SUFFTSxNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUFjLEVBQUUsT0FBZSxFQUFFLE9BQWdCO1FBQzlFLE1BQU0sRUFBRSxHQUFHLElBQUksRUFBRSxFQUFFLENBQUE7UUFDbkIsTUFBTSxnQkFBZ0IsQ0FBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUVqRixPQUFPLElBQUkscUJBQXFCLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQTtJQUM1RCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcm90b2NvbCB9IGZyb20gJ0B1bmlzd2FwL3JvdXRlci1zZGsnXG5pbXBvcnQge1xuICBJVjJTdWJncmFwaFByb3ZpZGVyLFxuICBJVjNTdWJncmFwaFByb3ZpZGVyLFxuICBsb2csXG4gIFYyU3ViZ3JhcGhQb29sLFxuICBWM1N1YmdyYXBoUG9vbCxcbn0gZnJvbSAnQHVuaXN3YXAvc21hcnQtb3JkZXItcm91dGVyJ1xuaW1wb3J0IHsgUzMgfSBmcm9tICdhd3Mtc2RrJ1xuaW1wb3J0IHsgQ2hhaW5JZCB9IGZyb20gJ0B1bmlzd2FwL3Nkay1jb3JlJ1xuaW1wb3J0IE5vZGVDYWNoZSBmcm9tICdub2RlLWNhY2hlJ1xuaW1wb3J0IHsgUzNfUE9PTF9DQUNIRV9LRVkgfSBmcm9tICcuLi8uLi91dGlsL3Bvb2wtY2FjaGUta2V5J1xuXG5jb25zdCBQT09MX0NBQ0hFID0gbmV3IE5vZGVDYWNoZSh7IHN0ZFRUTDogMjQwLCB1c2VDbG9uZXM6IGZhbHNlIH0pXG5jb25zdCBMT0NBTF9QT09MX0NBQ0hFX0tFWSA9IChjaGFpbklkOiBDaGFpbklkLCBwcm90b2NvbDogUHJvdG9jb2wpID0+IGBwb29scyR7Y2hhaW5JZH0jJHtwcm90b2NvbH1gXG5cbmV4cG9ydCBjbGFzcyBBV1NTdWJncmFwaFByb3ZpZGVyPFRTdWJncmFwaFBvb2wgZXh0ZW5kcyBWMlN1YmdyYXBoUG9vbCB8IFYzU3ViZ3JhcGhQb29sPiB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2hhaW46IENoYWluSWQsIHByaXZhdGUgcHJvdG9jb2w6IFByb3RvY29sLCBwcml2YXRlIGJ1Y2tldDogc3RyaW5nLCBwcml2YXRlIGJhc2VLZXk6IHN0cmluZykge31cblxuICBwdWJsaWMgYXN5bmMgZ2V0UG9vbHMoKTogUHJvbWlzZTxUU3ViZ3JhcGhQb29sW10+IHtcbiAgICBsb2cuaW5mbyhgSW4gbmV3IEFXUyBzdWJncmFwaCBwcm92aWRlciBmb3IgcHJvdG9jb2wgJHt0aGlzLnByb3RvY29sfWApXG5cbiAgICBjb25zdCBjYWNoZWRQb29scyA9IFBPT0xfQ0FDSEUuZ2V0PFRTdWJncmFwaFBvb2xbXT4oTE9DQUxfUE9PTF9DQUNIRV9LRVkodGhpcy5jaGFpbiwgdGhpcy5wcm90b2NvbCkpXG5cbiAgICBpZiAoY2FjaGVkUG9vbHMpIHtcbiAgICAgIGxvZy5pbmZvKFxuICAgICAgICB7IHN1YmdyYXBoUG9vbHNTYW1wbGU6IGNhY2hlZFBvb2xzLnNsaWNlKDAsIDUpIH0sXG4gICAgICAgIGBTdWJncmFwaCBwb29scyBmZXRjaGVkIGZyb20gbG9jYWwgY2FjaGUgZm9yIHByb3RvY29sICR7dGhpcy5wcm90b2NvbH0uIE51bTogJHtjYWNoZWRQb29scy5sZW5ndGh9YFxuICAgICAgKVxuXG4gICAgICByZXR1cm4gY2FjaGVkUG9vbHNcbiAgICB9XG5cbiAgICBsb2cuaW5mbyhcbiAgICAgIHsgYnVja2V0OiB0aGlzLmJ1Y2tldCwga2V5OiB0aGlzLmJhc2VLZXkgfSxcbiAgICAgIGBTdWJncmFwaCBwb29scyBsb2NhbCBjYWNoZSBtaXNzIGZvciBwcm90b2NvbCAke3RoaXMucHJvdG9jb2x9LiBHZXR0aW5nIHN1YmdyYXBoIHBvb2xzIGZyb20gUzNgXG4gICAgKVxuXG4gICAgY29uc3QgczMgPSBuZXcgUzMoKVxuXG4gICAgY29uc3QgcG9vbHMgPSBhd2FpdCBjYWNoZVBvb2xzRnJvbVMzPFRTdWJncmFwaFBvb2w+KHMzLCB0aGlzLmJ1Y2tldCwgdGhpcy5iYXNlS2V5LCB0aGlzLmNoYWluLCB0aGlzLnByb3RvY29sKVxuXG4gICAgcmV0dXJuIHBvb2xzXG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGNhY2hlUG9vbHNGcm9tUzMgPSBhc3luYyA8VFN1YmdyYXBoUG9vbD4oXG4gIHMzOiBTMyxcbiAgYnVja2V0OiBzdHJpbmcsXG4gIGJhc2VLZXk6IHN0cmluZyxcbiAgY2hhaW5JZDogQ2hhaW5JZCxcbiAgcHJvdG9jb2w6IFByb3RvY29sXG4pID0+IHtcbiAgY29uc3Qga2V5ID0gUzNfUE9PTF9DQUNIRV9LRVkoYmFzZUtleSwgY2hhaW5JZCwgcHJvdG9jb2wpXG5cbiAgbGV0IHJlc3VsdFxuICB0cnkge1xuICAgIHJlc3VsdCA9IGF3YWl0IHMzLmdldE9iamVjdCh7IEtleToga2V5LCBCdWNrZXQ6IGJ1Y2tldCB9KS5wcm9taXNlKClcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLmVycm9yKHsgYnVja2V0LCBrZXksIGVyciB9LCBgRmFpbGVkIHRvIGdldCBwb29scyBmcm9tIFMzIGZvciAke3Byb3RvY29sfSBvbiBjaGFpbiAke2NoYWluSWR9YClcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgcG9vbHMgZnJvbSBTMyBmb3IgJHtwcm90b2NvbH0gb24gY2hhaW4gJHtjaGFpbklkfWApXG4gIH1cblxuICBjb25zdCB7IEJvZHk6IHBvb2xzQnVmZmVyIH0gPSByZXN1bHRcblxuICBpZiAoIXBvb2xzQnVmZmVyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgZ2V0IHN1YmdyYXBoIHBvb2wgY2FjaGUgZnJvbSBTMyBmb3IgcHJvdG9jb2wgJHtwcm90b2NvbH0gb24gY2hhaW4gJHtjaGFpbklkfWApXG4gIH1cblxuICBjb25zdCBwb29scyA9IEpTT04ucGFyc2UocG9vbHNCdWZmZXIudG9TdHJpbmcoJ3V0Zi04JykpIGFzIFRTdWJncmFwaFBvb2xbXVxuXG4gIGxvZy5pbmZvKHsgYnVja2V0LCBrZXkgfSwgYEdvdCBzdWJncmFwaCBwb29scyBmcm9tIFMzIGZvciBwcm90b2NvbCAke3Byb3RvY29sfSBvbiAke2NoYWluSWR9LiBOdW06ICR7cG9vbHMubGVuZ3RofWApXG5cbiAgUE9PTF9DQUNIRS5zZXQ8VFN1YmdyYXBoUG9vbFtdPihMT0NBTF9QT09MX0NBQ0hFX0tFWShjaGFpbklkLCBwcm90b2NvbCksIHBvb2xzKVxuXG4gIHJldHVybiBwb29sc1xufVxuXG5leHBvcnQgY2xhc3MgVjNBV1NTdWJncmFwaFByb3ZpZGVyIGV4dGVuZHMgQVdTU3ViZ3JhcGhQcm92aWRlcjxWM1N1YmdyYXBoUG9vbD4gaW1wbGVtZW50cyBJVjNTdWJncmFwaFByb3ZpZGVyIHtcbiAgY29uc3RydWN0b3IoY2hhaW5JZDogQ2hhaW5JZCwgYnVja2V0OiBzdHJpbmcsIGJhc2VLZXk6IHN0cmluZykge1xuICAgIHN1cGVyKGNoYWluSWQsIFByb3RvY29sLlYzLCBidWNrZXQsIGJhc2VLZXkpXG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGFzeW5jIEVhZ2VyQnVpbGQoYnVja2V0OiBzdHJpbmcsIGJhc2VLZXk6IHN0cmluZywgY2hhaW5JZDogQ2hhaW5JZCk6IFByb21pc2U8VjNBV1NTdWJncmFwaFByb3ZpZGVyPiB7XG4gICAgY29uc3QgczMgPSBuZXcgUzMoKVxuICAgIGF3YWl0IGNhY2hlUG9vbHNGcm9tUzM8VjNTdWJncmFwaFBvb2w+KHMzLCBidWNrZXQsIGJhc2VLZXksIGNoYWluSWQsIFByb3RvY29sLlYzKVxuXG4gICAgcmV0dXJuIG5ldyBWM0FXU1N1YmdyYXBoUHJvdmlkZXIoY2hhaW5JZCwgYnVja2V0LCBiYXNlS2V5KVxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBWMkFXU1N1YmdyYXBoUHJvdmlkZXIgZXh0ZW5kcyBBV1NTdWJncmFwaFByb3ZpZGVyPFYyU3ViZ3JhcGhQb29sPiBpbXBsZW1lbnRzIElWMlN1YmdyYXBoUHJvdmlkZXIge1xuICBjb25zdHJ1Y3RvcihjaGFpbklkOiBDaGFpbklkLCBidWNrZXQ6IHN0cmluZywga2V5OiBzdHJpbmcpIHtcbiAgICBzdXBlcihjaGFpbklkLCBQcm90b2NvbC5WMiwgYnVja2V0LCBrZXkpXG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGFzeW5jIEVhZ2VyQnVpbGQoYnVja2V0OiBzdHJpbmcsIGJhc2VLZXk6IHN0cmluZywgY2hhaW5JZDogQ2hhaW5JZCk6IFByb21pc2U8VjJBV1NTdWJncmFwaFByb3ZpZGVyPiB7XG4gICAgY29uc3QgczMgPSBuZXcgUzMoKVxuICAgIGF3YWl0IGNhY2hlUG9vbHNGcm9tUzM8VjJTdWJncmFwaFBvb2w+KHMzLCBidWNrZXQsIGJhc2VLZXksIGNoYWluSWQsIFByb3RvY29sLlYyKVxuXG4gICAgcmV0dXJuIG5ldyBWMkFXU1N1YmdyYXBoUHJvdmlkZXIoY2hhaW5JZCwgYnVja2V0LCBiYXNlS2V5KVxuICB9XG59XG4iXX0=