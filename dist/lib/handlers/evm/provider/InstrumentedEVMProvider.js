import { ethers } from 'ethers';
import { metric, MetricLoggerUnit } from '@uniswap/smart-order-router';
export class InstrumentedEVMProvider extends ethers.providers.JsonRpcProvider {
    constructor({ url, network, name }) {
        super(url, network);
        this.name = name;
        this.metricPrefix = `RPC_${this.name}_${this.network.chainId}`;
    }
    call(transaction, blockTag) {
        return super
            .call(transaction, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_CALL_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_CALL_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_CALL_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    estimateGas(transaction) {
        return super
            .estimateGas(transaction)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_ESTIMATEGAS_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_ESTIMATEGAS_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_ESTIMATEGAS_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getBalance(addressOrName, blockTag) {
        return super
            .getBalance(addressOrName, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETBALANCE_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETBALANCE_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETBALANCE_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getBlock(blockHashOrBlockTag) {
        return super
            .getBlock(blockHashOrBlockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCK_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCK_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETBLOCK_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getBlockNumber() {
        return super
            .getBlockNumber()
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCKNUMBER_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCKNUMBER_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETBLOCKNUMBER_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getBlockWithTransactions(blockHashOrBlockTag) {
        return super
            .getBlockWithTransactions(blockHashOrBlockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCKWITHTRANSACTION_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCKWITHTRANSACTION_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETBLOCKWITHTRANSACTION_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getCode(addressOrName, blockTag) {
        return super
            .getCode(addressOrName, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETCODE_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETCODE_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETCODE_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getGasPrice() {
        return super
            .getGasPrice()
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETGASPRICE_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETGASPRICE_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETGASPRICE_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getLogs(filter) {
        return super
            .getLogs(filter)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETLOGS_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETLOGS_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETLOGS_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getNetwork() {
        return super
            .getNetwork()
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETNETWORK_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETNETWORK_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETNETWORK_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getStorageAt(addressOrName, position, blockTag) {
        return super
            .getStorageAt(addressOrName, position, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETSTORAGEAT_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETSTORAGEAT_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETSTORAGEAT_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getTransaction(transactionHash) {
        return super
            .getTransaction(transactionHash)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTION_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTION_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETTRANSACTION_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getTransactionCount(addressOrName, blockTag) {
        return super
            .getTransactionCount(addressOrName, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONCOUNT_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONCOUNT_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONCOUNT_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getTransactionReceipt(transactionHash) {
        return super
            .getTransactionReceipt(transactionHash)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONRECEIPT_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONRECEIPT_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONRECEIPT_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    lookupAddress(address) {
        return super
            .lookupAddress(address)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_LOOKUPADDRESS_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_LOOKUPADDRESS_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_LOOKUPADDRESS_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    resolveName(name) {
        return super
            .resolveName(name)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_RESOLVENAME_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_RESOLVENAME_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_RESOLVENAME_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    sendTransaction(signedTransaction) {
        return super
            .sendTransaction(signedTransaction)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_SENDTRANSACTION_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_SENDTRANSACTION_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_SENDTRANSACTION_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    waitForTransaction(transactionHash, confirmations, timeout) {
        return super
            .waitForTransaction(transactionHash, confirmations, timeout)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_WAITFORTRANSACTION_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_WAITFORTRANSACTION_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_WAITFORTRANSACTION_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5zdHJ1bWVudGVkRVZNUHJvdmlkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9saWIvaGFuZGxlcnMvZXZtL3Byb3ZpZGVyL0luc3RydW1lbnRlZEVWTVByb3ZpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxRQUFRLENBQUE7QUFZL0IsT0FBTyxFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDZCQUE2QixDQUFBO0FBWXRFLE1BQU0sT0FBTyx1QkFBd0IsU0FBUSxNQUFNLENBQUMsU0FBUyxDQUFDLGVBQWU7SUFJM0UsWUFBWSxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFnQztRQUM5RCxLQUFLLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFBO1FBQ25CLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFBO1FBQ2hCLElBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUE7SUFDaEUsQ0FBQztJQUVRLElBQUksQ0FBQyxXQUEyQyxFQUFFLFFBQXVDO1FBQ2hHLE9BQU8sS0FBSzthQUNULElBQUksQ0FBQyxXQUFXLEVBQUUsUUFBUSxDQUFDO2FBQzNCLElBQUksQ0FDSCxDQUFDLFFBQVEsRUFBRSxFQUFFO1lBQ1gsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZLGVBQWUsRUFBRSxDQUFDLEVBQUUsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUE7WUFDaEYsT0FBTyxRQUFRLENBQUE7UUFDakIsQ0FBQyxFQUNELENBQUMsS0FBSyxFQUFFLEVBQUU7WUFDUixNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLFlBQVksZUFBZSxFQUFFLENBQUMsRUFBRSxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQTtZ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QUMsQ0FBQyxDQUFBO0lBQ3BILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV0aGVycyB9IGZyb20gJ2V0aGVycydcbmltcG9ydCB7IERlZmVycmFibGUgfSBmcm9tICdAZXRoZXJzcHJvamVjdC9wcm9wZXJ0aWVzJ1xuaW1wb3J0IHsgVHJhbnNhY3Rpb25SZXF1ZXN0IH0gZnJvbSAnQGV0aGVyc3Byb2plY3QvcHJvdmlkZXJzJ1xuaW1wb3J0IHtcbiAgQmxvY2ssXG4gIEJsb2NrVGFnLFxuICBCbG9ja1dpdGhUcmFuc2FjdGlvbnMsXG4gIEZpbHRlcixcbiAgTG9nLFxuICBUcmFuc2FjdGlvblJlY2VpcHQsXG4gIFRyYW5zYWN0aW9uUmVzcG9uc2UsXG59IGZyb20gJ0BldGhlcnNwcm9qZWN0L2Fic3RyYWN0LXByb3ZpZGVyJ1xuaW1wb3J0IHsgbWV0cmljLCBNZXRyaWNMb2dnZXJVbml0IH0gZnJvbSAnQHVuaXN3YXAvc21hcnQtb3JkZXItcm91dGVyJ1xuaW1wb3J0IHsgQmlnTnVtYmVyLCBCaWdOdW1iZXJpc2ggfSBmcm9tICdAZXRoZXJzcHJvamVjdC9iaWdudW1iZXInXG5pbXBvcnQgeyBOZXR3b3JrLCBOZXR3b3JraXNoIH0gZnJvbSAnQGV0aGVyc3Byb2plY3QvbmV0d29ya3MnXG5pbXBvcnQgeyBDb25uZWN0aW9uSW5mbyB9IGZyb20gJ0BldGhlcnNwcm9qZWN0L3dlYidcbmltcG9ydCB7IFByb3ZpZGVyTmFtZSB9IGZyb20gJy4vUHJvdmlkZXJOYW1lJ1xuXG5leHBvcnQgdHlwZSBJbnN0cnVtZW50ZWRFVk1Qcm92aWRlclByb3BzID0ge1xuICB1cmw/OiBDb25uZWN0aW9uSW5mbyB8IHN0cmluZ1xuICBuZXR3b3JrPzogTmV0d29ya2lzaFxuICBuYW1lOiBQcm92aWRlck5hbWVcbn1cblxuZXhwb3J0IGNsYXNzIEluc3RydW1lbnRlZEVWTVByb3ZpZGVyIGV4dGVuZHMgZXRoZXJzLnByb3ZpZGVycy5Kc29uUnBjUHJvdmlkZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IG5hbWU6IFByb3ZpZGVyTmFtZVxuICBwcml2YXRlIHJlYWRvbmx5IG1ldHJpY1ByZWZpeDogc3RyaW5nXG5cbiAgY29uc3RydWN0b3IoeyB1cmwsIG5ldHdvcmssIG5hbWUgfTogSW5zdHJ1bWVudGVkRVZNUHJvdmlkZXJQcm9wcykge1xuICAgIHN1cGVyKHVybCwgbmV0d29yaylcbiAgICB0aGlzLm5hbWUgPSBuYW1lXG4gICAgdGhpcy5tZXRyaWNQcmVmaXggPSBgUlBDXyR7dGhpcy5uYW1lfV8ke3RoaXMubmV0d29yay5jaGFpbklkfWBcbiAgfVxuXG4gIG92ZXJyaWRlIGNhbGwodHJhbnNhY3Rpb246IERlZmVycmFibGU8VHJhbnNhY3Rpb25SZXF1ZXN0PiwgYmxvY2tUYWc/OiBCbG9ja1RhZyB8IFByb21pc2U8QmxvY2tUYWc+KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5jYWxsKHRyYW5zYWN0aW9uLCBibG9ja1RhZylcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9DQUxMX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9DQUxMX0ZBSUxVUkVgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0NBTExfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpXG4gIH1cblxuICBvdmVycmlkZSBlc3RpbWF0ZUdhcyh0cmFuc2FjdGlvbjogRGVmZXJyYWJsZTxUcmFuc2FjdGlvblJlcXVlc3Q+KTogUHJvbWlzZTxCaWdOdW1iZXI+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5lc3RpbWF0ZUdhcyh0cmFuc2FjdGlvbilcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9FU1RJTUFURUdBU19TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fRVNUSU1BVEVHQVNfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fRVNUSU1BVEVHQVNfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpXG4gIH1cblxuICBvdmVycmlkZSBnZXRCYWxhbmNlKFxuICAgIGFkZHJlc3NPck5hbWU6IHN0cmluZyB8IFByb21pc2U8c3RyaW5nPixcbiAgICBibG9ja1RhZz86IEJsb2NrVGFnIHwgUHJvbWlzZTxCbG9ja1RhZz5cbiAgKTogUHJvbWlzZTxCaWdOdW1iZXI+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5nZXRCYWxhbmNlKGFkZHJlc3NPck5hbWUsIGJsb2NrVGFnKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEJBTEFOQ0VfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEJBTEFOQ0VfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQkFMQU5DRV9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSlcbiAgfVxuXG4gIG92ZXJyaWRlIGdldEJsb2NrKGJsb2NrSGFzaE9yQmxvY2tUYWc6IEJsb2NrVGFnIHwgc3RyaW5nIHwgUHJvbWlzZTxCbG9ja1RhZyB8IHN0cmluZz4pOiBQcm9taXNlPEJsb2NrPiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAuZ2V0QmxvY2soYmxvY2tIYXNoT3JCbG9ja1RhZylcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRCTE9DS19TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQkxPQ0tfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQkxPQ0tfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpXG4gIH1cblxuICBvdmVycmlkZSBnZXRCbG9ja051bWJlcigpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmdldEJsb2NrTnVtYmVyKClcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRCTE9DS05VTUJFUl9TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQkxPQ0tOVU1CRVJfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQkxPQ0tOVU1CRVJfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpXG4gIH1cblxuICBvdmVycmlkZSBnZXRCbG9ja1dpdGhUcmFuc2FjdGlvbnMoXG4gICAgYmxvY2tIYXNoT3JCbG9ja1RhZzogQmxvY2tUYWcgfCBzdHJpbmcgfCBQcm9taXNlPEJsb2NrVGFnIHwgc3RyaW5nPlxuICApOiBQcm9taXNlPEJsb2NrV2l0aFRyYW5zYWN0aW9ucz4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmdldEJsb2NrV2l0aFRyYW5zYWN0aW9ucyhibG9ja0hhc2hPckJsb2NrVGFnKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEJMT0NLV0lUSFRSQU5TQUNUSU9OX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRCTE9DS1dJVEhUUkFOU0FDVElPTl9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PlxuICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRCTE9DS1dJVEhUUkFOU0FDVElPTl9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgKVxuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0Q29kZShhZGRyZXNzT3JOYW1lOiBzdHJpbmcgfCBQcm9taXNlPHN0cmluZz4sIGJsb2NrVGFnPzogQmxvY2tUYWcgfCBQcm9taXNlPEJsb2NrVGFnPik6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAuZ2V0Q29kZShhZGRyZXNzT3JOYW1lLCBibG9ja1RhZylcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRDT0RFX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRDT0RFX0ZBSUxVUkVgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVENPREVfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpXG4gIH1cblxuICBvdmVycmlkZSBnZXRHYXNQcmljZSgpOiBQcm9taXNlPEJpZ051bWJlcj4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmdldEdhc1ByaWNlKClcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRHQVNQUklDRV9TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUR0FTUFJJQ0VfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUR0FTUFJJQ0VfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpXG4gIH1cblxuICBvdmVycmlkZSBnZXRMb2dzKGZpbHRlcjogRmlsdGVyKTogUHJvbWlzZTxBcnJheTxMb2c+PiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAuZ2V0TG9ncyhmaWx0ZXIpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUTE9HU19TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUTE9HU19GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRMT0dTX1JFUVVFU1RFRGAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpKVxuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0TmV0d29yaygpOiBQcm9taXNlPE5ldHdvcms+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5nZXROZXR3b3JrKClcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRORVRXT1JLX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRORVRXT1JLX0ZBSUxVUkVgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVE5FVFdPUktfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpXG4gIH1cblxuICBvdmVycmlkZSBnZXRTdG9yYWdlQXQoXG4gICAgYWRkcmVzc09yTmFtZTogc3RyaW5nIHwgUHJvbWlzZTxzdHJpbmc+LFxuICAgIHBvc2l0aW9uOiBCaWdOdW1iZXJpc2ggfCBQcm9taXNlPEJpZ051bWJlcmlzaD4sXG4gICAgYmxvY2tUYWc/OiBCbG9ja1RhZyB8IFByb21pc2U8QmxvY2tUYWc+XG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAuZ2V0U3RvcmFnZUF0KGFkZHJlc3NPck5hbWUsIHBvc2l0aW9uLCBibG9ja1RhZylcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRTVE9SQUdFQVRfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFNUT1JBR0VBVF9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRTVE9SQUdFQVRfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpXG4gIH1cblxuICBvdmVycmlkZSBnZXRUcmFuc2FjdGlvbih0cmFuc2FjdGlvbkhhc2g6IHN0cmluZyk6IFByb21pc2U8VHJhbnNhY3Rpb25SZXNwb25zZT4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmdldFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSGFzaClcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRUUkFOU0FDVElPTl9TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUVFJBTlNBQ1RJT05fRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUVFJBTlNBQ1RJT05fUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpXG4gIH1cblxuICBvdmVycmlkZSBnZXRUcmFuc2FjdGlvbkNvdW50KFxuICAgIGFkZHJlc3NPck5hbWU6IHN0cmluZyB8IFByb21pc2U8c3RyaW5nPixcbiAgICBibG9ja1RhZz86IEJsb2NrVGFnIHwgUHJvbWlzZTxCbG9ja1RhZz5cbiAgKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5nZXRUcmFuc2FjdGlvbkNvdW50KGFkZHJlc3NPck5hbWUsIGJsb2NrVGFnKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFRSQU5TQUNUSU9OQ09VTlRfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFRSQU5TQUNUSU9OQ09VTlRfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUVFJBTlNBQ1RJT05DT1VOVF9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSlcbiAgfVxuXG4gIG92ZXJyaWRlIGdldFRyYW5zYWN0aW9uUmVjZWlwdCh0cmFuc2FjdGlvbkhhc2g6IHN0cmluZyk6IFByb21pc2U8VHJhbnNhY3Rpb25SZWNlaXB0PiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAuZ2V0VHJhbnNhY3Rpb25SZWNlaXB0KHRyYW5zYWN0aW9uSGFzaClcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRUUkFOU0FDVElPTlJFQ0VJUFRfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFRSQU5TQUNUSU9OUkVDRUlQVF9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PlxuICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRUUkFOU0FDVElPTlJFQ0VJUFRfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgIClcbiAgfVxuXG4gIG92ZXJyaWRlIGxvb2t1cEFkZHJlc3MoYWRkcmVzczogc3RyaW5nIHwgUHJvbWlzZTxzdHJpbmc+KTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAubG9va3VwQWRkcmVzcyhhZGRyZXNzKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0xPT0tVUEFERFJFU1NfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0xPT0tVUEFERFJFU1NfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fTE9PS1VQQUREUkVTU19SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSlcbiAgfVxuXG4gIG92ZXJyaWRlIHJlc29sdmVOYW1lKG5hbWU6IHN0cmluZyB8IFByb21pc2U8c3RyaW5nPik6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLnJlc29sdmVOYW1lKG5hbWUpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fUkVTT0xWRU5BTUVfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X1JFU09MVkVOQU1FX0ZBSUxVUkVgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X1JFU09MVkVOQU1FX1JFUVVFU1RFRGAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpKVxuICB9XG5cbiAgb3ZlcnJpZGUgc2VuZFRyYW5zYWN0aW9uKHNpZ25lZFRyYW5zYWN0aW9uOiBzdHJpbmcgfCBQcm9taXNlPHN0cmluZz4pOiBQcm9taXNlPFRyYW5zYWN0aW9uUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5zZW5kVHJhbnNhY3Rpb24oc2lnbmVkVHJhbnNhY3Rpb24pXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fU0VORFRSQU5TQUNUSU9OX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9TRU5EVFJBTlNBQ1RJT05fRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fU0VORFRSQU5TQUNUSU9OX1JFUVVFU1RFRGAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpKVxuICB9XG5cbiAgb3ZlcnJpZGUgd2FpdEZvclRyYW5zYWN0aW9uKFxuICAgIHRyYW5zYWN0aW9uSGFzaDogc3RyaW5nLFxuICAgIGNvbmZpcm1hdGlvbnM/OiBudW1iZXIsXG4gICAgdGltZW91dD86IG51bWJlclxuICApOiBQcm9taXNlPFRyYW5zYWN0aW9uUmVjZWlwdD4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLndhaXRGb3JUcmFuc2FjdGlvbih0cmFuc2FjdGlvbkhhc2gsIGNvbmZpcm1hdGlvbnMsIHRpbWVvdXQpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fV0FJVEZPUlRSQU5TQUNUSU9OX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9XQUlURk9SVFJBTlNBQ1RJT05fRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fV0FJVEZPUlRSQU5TQUNUSU9OX1JFUVVFU1RFRGAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpKVxuICB9XG59XG4iXX0=