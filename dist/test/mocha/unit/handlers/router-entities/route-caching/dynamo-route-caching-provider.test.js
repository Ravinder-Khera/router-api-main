import chai, { expect } from 'chai';
import chaiAsPromised from 'chai-as-promised';
import 'reflect-metadata';
import { setupTables } from '../../../../dbSetup';
import { DynamoRouteCachingProvider } from '../../../../../../lib/handlers/router-entities/route-caching';
import { Protocol } from '@uniswap/router-sdk';
import { ChainId, CurrencyAmount, TradeType } from '@uniswap/sdk-core';
import JSBI from 'jsbi';
import { FeeAmount, Pool } from '@uniswap/v3-sdk';
import { WNATIVE_ON } from '../../../../../utils/tokens';
import { CacheMode, CachedRoute, CachedRoutes, UNI_MAINNET, USDC_MAINNET, V3Route } from '@uniswap/smart-order-router';
chai.use(chaiAsPromised);
const TEST_ROUTE_TABLE = {
    TableName: 'RouteCachingDB',
    KeySchema: [
        {
            AttributeName: 'pairTradeTypeChainId',
            KeyType: 'HASH',
        },
        {
            AttributeName: 'protocolsBucketBlockNumber',
            KeyType: 'RANGE',
        },
    ],
    AttributeDefinitions: [
        {
            AttributeName: 'pairTradeTypeChainId',
            AttributeType: 'S',
        },
        {
            AttributeName: 'protocolsBucketBlockNumber',
            AttributeType: 'S',
        },
    ],
    ProvisionedThroughput: {
        ReadCapacityUnits: 1,
        WriteCapacityUnits: 1,
    },
};
const WETH = WNATIVE_ON(ChainId.MAINNET);
const TEST_WETH_USDC_POOL = new Pool(WETH, USDC_MAINNET, FeeAmount.HIGH, 
/* sqrtRatio */ '2437312313659959819381354528', 
/* liquidity */ '10272714736694327408', 
/* tickCurrent */ -69633);
const TEST_USDC_WETH_POOL = new Pool(USDC_MAINNET, WETH, FeeAmount.HIGH, 
/* sqrtRatio */ '2437312313659959819381354528', 
/* liquidity */ '10272714736694327408', 
/* tickCurrent */ -69633);
const TEST_UNI_USDC_POOL = new Pool(UNI_MAINNET, USDC_MAINNET, FeeAmount.HIGH, 
/* sqrtRatio */ '2437312313659959819381354528', 
/* liquidity */ '10272714736694327408', 
/* tickCurrent */ -69633);
const TEST_WETH_USDC_V3_ROUTE = new V3Route([TEST_WETH_USDC_POOL], WETH, USDC_MAINNET);
const TEST_USDC_WETH_V3_ROUTE = new V3Route([TEST_USDC_WETH_POOL], USDC_MAINNET, WETH);
const TEST_UNI_USDC_ROUTE = new V3Route([TEST_UNI_USDC_POOL], UNI_MAINNET, USDC_MAINNET);
const TEST_CACHED_ROUTE = new CachedRoute({ route: TEST_WETH_USDC_V3_ROUTE, percent: 100 });
const TEST_CACHED_ROUTES = new CachedRoutes({
    routes: [TEST_CACHED_ROUTE],
    chainId: TEST_CACHED_ROUTE.route.chainId,
    tokenIn: WETH,
    tokenOut: USDC_MAINNET,
    protocolsCovered: [TEST_CACHED_ROUTE.protocol],
    blockNumber: 0,
    tradeType: TradeType.EXACT_INPUT,
    originalAmount: '1',
    blocksToLive: 5,
});
const TEST_CACHED_ROUTE_2 = new CachedRoute({ route: TEST_USDC_WETH_V3_ROUTE, percent: 100 });
const TEST_CACHED_ROUTES_2 = new CachedRoutes({
    routes: [TEST_CACHED_ROUTE_2],
    chainId: TEST_CACHED_ROUTE_2.route.chainId,
    tokenIn: USDC_MAINNET,
    tokenOut: WETH,
    protocolsCovered: [TEST_CACHED_ROUTE_2.protocol],
    blockNumber: 0,
    tradeType: TradeType.EXACT_OUTPUT,
    originalAmount: '1',
    blocksToLive: 5,
});
const TEST_UNCACHED_ROUTE = new CachedRoute({ route: TEST_UNI_USDC_ROUTE, percent: 100 });
const TEST_UNCACHED_ROUTES = new CachedRoutes({
    routes: [TEST_UNCACHED_ROUTE],
    chainId: TEST_UNCACHED_ROUTE.route.chainId,
    tokenIn: UNI_MAINNET,
    tokenOut: USDC_MAINNET,
    protocolsCovered: [TEST_UNCACHED_ROUTE.protocol],
    blockNumber: 0,
    tradeType: TradeType.EXACT_INPUT,
    originalAmount: '1',
    blocksToLive: 5,
});
describe('DynamoRouteCachingProvider', async () => {
    setupTables(TEST_ROUTE_TABLE);
    const dynamoRouteCache = new DynamoRouteCachingProvider({ cachedRoutesTableName: TEST_ROUTE_TABLE.TableName });
    it('Caches routes properly for a token pair that has its cache configured to Livemode', async () => {
        const currencyAmount = CurrencyAmount.fromRawAmount(WETH, JSBI.BigInt(1 * 10 ** WETH.decimals));
        const cacheMode = await dynamoRouteCache.getCacheMode(ChainId.MAINNET, currencyAmount, USDC_MAINNET, TradeType.EXACT_INPUT, [Protocol.V3]);
        expect(cacheMode).to.equal(CacheMode.Livemode);
        const insertedIntoCache = await dynamoRouteCache.setCachedRoute(TEST_CACHED_ROUTES, currencyAmount);
        expect(insertedIntoCache).to.be.true;
        const cacheModeFromCachedRoutes = await dynamoRouteCache.getCacheModeFromCachedRoutes(TEST_CACHED_ROUTES, currencyAmount);
        expect(cacheModeFromCachedRoutes).to.equal(CacheMode.Livemode);
        // Fetches route successfully from cache when it has been cached.
        const route = await dynamoRouteCache.getCachedRoute(ChainId.MAINNET, currencyAmount, USDC_MAINNET, TradeType.EXACT_INPUT, [Protocol.V3], TEST_CACHED_ROUTES.blockNumber);
        expect(route).to.not.be.undefined;
    });
    it('Caches routes properly for a token pair that has its cache configured to Tapcompare', async () => {
        const currencyAmount = CurrencyAmount.fromRawAmount(WETH, JSBI.BigInt(100 * 10 ** WETH.decimals));
        const cacheMode = await dynamoRouteCache.getCacheMode(ChainId.MAINNET, currencyAmount, USDC_MAINNET, TradeType.EXACT_OUTPUT, [Protocol.V3]);
        expect(cacheMode).to.equal(CacheMode.Tapcompare);
        const insertedIntoCache = await dynamoRouteCache.setCachedRoute(TEST_CACHED_ROUTES_2, currencyAmount);
        expect(insertedIntoCache).to.be.true;
        const cacheModeFromCachedRoutes = await dynamoRouteCache.getCacheModeFromCachedRoutes(TEST_CACHED_ROUTES_2, currencyAmount);
        expect(cacheModeFromCachedRoutes).to.equal(CacheMode.Tapcompare);
        // Fetches route successfully from cache, since cache is active in Tapcompare mode.
        const route = await dynamoRouteCache.getCachedRoute(ChainId.MAINNET, currencyAmount, USDC_MAINNET, TradeType.EXACT_OUTPUT, [Protocol.V3], TEST_CACHED_ROUTES_2.blockNumber);
        expect(route).to.not.be.undefined;
    });
    it('Does not cache routes for a token pair that has its cache configured in the default Darkmode', async () => {
        const currencyAmount = CurrencyAmount.fromRawAmount(UNI_MAINNET, JSBI.BigInt(1 * 10 ** UNI_MAINNET.decimals));
        const cacheMode = await dynamoRouteCache.getCacheMode(ChainId.MAINNET, currencyAmount, USDC_MAINNET, TradeType.EXACT_INPUT, [Protocol.V3]);
        expect(cacheMode).to.equal(CacheMode.Darkmode);
        const insertedIntoCache = await dynamoRouteCache.setCachedRoute(TEST_UNCACHED_ROUTES, currencyAmount);
        expect(insertedIntoCache).to.be.false;
        const cacheModeFromCachedRoutes = await dynamoRouteCache.getCacheModeFromCachedRoutes(TEST_UNCACHED_ROUTES, currencyAmount);
        expect(cacheModeFromCachedRoutes).to.equal(CacheMode.Darkmode);
        // Fetches nothing from the cache since cache is in Darkmode.
        const route = await dynamoRouteCache.getCachedRoute(ChainId.MAINNET, currencyAmount, USDC_MAINNET, TradeType.EXACT_INPUT, [Protocol.V3], TEST_CACHED_ROUTES.blockNumber);
        expect(route).to.be.undefined;
    });
    it('Finds the CacheMode from a wildcard exact output configuration', async () => {
        const currencyAmount = CurrencyAmount.fromRawAmount(WETH, JSBI.BigInt(100 * 10 ** WETH.decimals));
        const cacheMode = await dynamoRouteCache.getCacheMode(ChainId.MAINNET, currencyAmount, USDC_MAINNET, TradeType.EXACT_OUTPUT, [Protocol.V3]);
        expect(cacheMode).to.equal(CacheMode.Tapcompare);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1vLXJvdXRlLWNhY2hpbmctcHJvdmlkZXIudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Rlc3QvbW9jaGEvdW5pdC9oYW5kbGVycy9yb3V0ZXItZW50aXRpZXMvcm91dGUtY2FjaGluZy9keW5hbW8tcm91dGUtY2FjaGluZy1wcm92aWRlci50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sSUFBSSxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQU0sTUFBTSxDQUFBO0FBQ25DLE9BQU8sY0FBYyxNQUFNLGtCQUFrQixDQUFBO0FBQzdDLE9BQU8sa0JBQWtCLENBQUE7QUFDekIsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFBO0FBQ2pELE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLDhEQUE4RCxDQUFBO0FBQ3pHLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQTtBQUM5QyxPQUFPLEVBQUUsT0FBTyxFQUFFLGNBQWMsRUFBRSxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQTtBQUN0RSxPQUFPLElBQUksTUFBTSxNQUFNLENBQUE7QUFDdkIsT0FBTyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQTtBQUNqRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sNkJBQTZCLENBQUE7QUFDeEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsT0FBTyxFQUFFLE1BQU0sNkJBQTZCLENBQUE7QUFFdEgsSUFBSSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQTtBQUV4QixNQUFNLGdCQUFnQixHQUFHO0lBQ3ZCLFNBQVMsRUFBRSxnQkFBZ0I7SUFDM0IsU0FBUyxFQUFFO1FBQ1Q7WUFDRSxhQUFhLEVBQUUsc0JBQXNCO1lBQ3JDLE9BQU8sRUFBRSxNQUFNO1NB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RyxFQUFFLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUE7UUFDakcsTUFBTSxTQUFTLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxZQUFZLENBQ25ELE9BQU8sQ0FBQyxPQUFPLEVBQ2YsY0FBYyxFQUNkLFlBQVksRUFDWixTQUFTLENBQUMsWUFBWSxFQUN0QixDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FDZCxDQUFBO1FBQ0QsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFBO0lBQ2xELENBQUMsQ0FBQyxDQUFBO0FBQ0osQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhaSwgeyBleHBlY3QgfSBmcm9tICdjaGFpJ1xuaW1wb3J0IGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnXG5pbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnXG5pbXBvcnQgeyBzZXR1cFRhYmxlcyB9IGZyb20gJy4uLy4uLy4uLy4uL2RiU2V0dXAnXG5pbXBvcnQgeyBEeW5hbW9Sb3V0ZUNhY2hpbmdQcm92aWRlciB9IGZyb20gJy4uLy4uLy4uLy4uLy4uLy4uL2xpYi9oYW5kbGVycy9yb3V0ZXItZW50aXRpZXMvcm91dGUtY2FjaGluZydcbmltcG9ydCB7IFByb3RvY29sIH0gZnJvbSAnQHVuaXN3YXAvcm91dGVyLXNkaydcbmltcG9ydCB7IENoYWluSWQsIEN1cnJlbmN5QW1vdW50LCBUcmFkZVR5cGUgfSBmcm9tICdAdW5pc3dhcC9zZGstY29yZSdcbmltcG9ydCBKU0JJIGZyb20gJ2pzYmknXG5pbXBvcnQgeyBGZWVBbW91bnQsIFBvb2wgfSBmcm9tICdAdW5pc3dhcC92My1zZGsnXG5pbXBvcnQgeyBXTkFUSVZFX09OIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vdXRpbHMvdG9rZW5zJ1xuaW1wb3J0IHsgQ2FjaGVNb2RlLCBDYWNoZWRSb3V0ZSwgQ2FjaGVkUm91dGVzLCBVTklfTUFJTk5FVCwgVVNEQ19NQUlOTkVULCBWM1JvdXRlIH0gZnJvbSAnQHVuaXN3YXAvc21hcnQtb3JkZXItcm91dGVyJ1xuXG5jaGFpLnVzZShjaGFpQXNQcm9taXNlZClcblxuY29uc3QgVEVTVF9ST1VURV9UQUJMRSA9IHtcbiAgVGFibGVOYW1lOiAnUm91dGVDYWNoaW5nREInLFxuICBLZXlTY2hlbWE6IFtcbiAgICB7XG4gICAgICBBdHRyaWJ1dGVOYW1lOiAncGFpclRyYWRlVHlwZUNoYWluSWQnLFxuICAgICAgS2V5VHlwZTogJ0hBU0gnLFxuICAgIH0sXG4gICAge1xuICAgICAgQXR0cmlidXRlTmFtZTogJ3Byb3RvY29sc0J1Y2tldEJsb2NrTnVtYmVyJyxcbiAgICAgIEtleVR5cGU6ICdSQU5HRScsXG4gICAgfSxcbiAgXSxcbiAgQXR0cmlidXRlRGVmaW5pdGlvbnM6IFtcbiAgICB7XG4gICAgICBBdHRyaWJ1dGVOYW1lOiAncGFpclRyYWRlVHlwZUNoYWluSWQnLFxuICAgICAgQXR0cmlidXRlVHlwZTogJ1MnLFxuICAgIH0sXG4gICAge1xuICAgICAgQXR0cmlidXRlTmFtZTogJ3Byb3RvY29sc0J1Y2tldEJsb2NrTnVtYmVyJyxcbiAgICAgIEF0dHJpYnV0ZVR5cGU6ICdTJyxcbiAgICB9LFxuICBdLFxuICBQcm92aXNpb25lZFRocm91Z2hwdXQ6IHtcbiAgICBSZWFkQ2FwYWNpdHlVbml0czogMSxcbiAgICBXcml0ZUNhcGFjaXR5VW5pdHM6IDEsXG4gIH0sXG59XG5cbmNvbnN0IFdFVEggPSBXTkFUSVZFX09OKENoYWluSWQuTUFJTk5FVClcblxuY29uc3QgVEVTVF9XRVRIX1VTRENfUE9PTCA9IG5ldyBQb29sKFxuICBXRVRILFxuICBVU0RDX01BSU5ORVQsXG4gIEZlZUFtb3VudC5ISUdILFxuICAvKiBzcXJ0UmF0aW8gKi8gJzI0MzczMTIzMTM2NTk5NTk4MTkzODEzNTQ1MjgnLFxuICAvKiBsaXF1aWRpdHkgKi8gJzEwMjcyNzE0NzM2Njk0MzI3NDA4JyxcbiAgLyogdGlja0N1cnJlbnQgKi8gLTY5NjMzXG4pXG5cbmNvbnN0IFRFU1RfVVNEQ19XRVRIX1BPT0wgPSBuZXcgUG9vbChcbiAgVVNEQ19NQUlOTkVULFxuICBXRVRILFxuICBGZWVBbW91bnQuSElHSCxcbiAgLyogc3FydFJhdGlvICovICcyNDM3MzEyMzEzNjU5OTU5ODE5MzgxMzU0NTI4JyxcbiAgLyogbGlxdWlkaXR5ICovICcxMDI3MjcxNDczNjY5NDMyNzQwOCcsXG4gIC8qIHRpY2tDdXJyZW50ICovIC02OTYzM1xuKVxuXG5jb25zdCBURVNUX1VOSV9VU0RDX1BPT0wgPSBuZXcgUG9vbChcbiAgVU5JX01BSU5ORVQsXG4gIFVTRENfTUFJTk5FVCxcbiAgRmVlQW1vdW50LkhJR0gsXG4gIC8qIHNxcnRSYXRpbyAqLyAnMjQzNzMxMjMxMzY1OTk1OTgxOTM4MTM1NDUyOCcsXG4gIC8qIGxpcXVpZGl0eSAqLyAnMTAyNzI3MTQ3MzY2OTQzMjc0MDgnLFxuICAvKiB0aWNrQ3VycmVudCAqLyAtNjk2MzNcbilcblxuY29uc3QgVEVTVF9XRVRIX1VTRENfVjNfUk9VVEUgPSBuZXcgVjNSb3V0ZShbVEVTVF9XRVRIX1VTRENfUE9PTF0sIFdFVEgsIFVTRENfTUFJTk5FVClcbmNvbnN0IFRFU1RfVVNEQ19XRVRIX1YzX1JPVVRFID0gbmV3IFYzUm91dGUoW1RFU1RfVVNEQ19XRVRIX1BPT0xdLCBVU0RDX01BSU5ORVQsIFdFVEgpXG5jb25zdCBURVNUX1VOSV9VU0RDX1JPVVRFID0gbmV3IFYzUm91dGUoW1RFU1RfVU5JX1VTRENfUE9PTF0sIFVOSV9NQUlOTkVULCBVU0RDX01BSU5ORVQpXG5cbmNvbnN0IFRFU1RfQ0FDSEVEX1JPVVRFID0gbmV3IENhY2hlZFJvdXRlKHsgcm91dGU6IFRFU1RfV0VUSF9VU0RDX1YzX1JPVVRFLCBwZXJjZW50OiAxMDAgfSlcbmNvbnN0IFRFU1RfQ0FDSEVEX1JPVVRFUyA9IG5ldyBDYWNoZWRSb3V0ZXMoe1xuICByb3V0ZXM6IFtURVNUX0NBQ0hFRF9ST1VURV0sXG4gIGNoYWluSWQ6IFRFU1RfQ0FDSEVEX1JPVVRFLnJvdXRlLmNoYWluSWQsXG4gIHRva2VuSW46IFdFVEgsXG4gIHRva2VuT3V0OiBVU0RDX01BSU5ORVQsXG4gIHByb3RvY29sc0NvdmVyZWQ6IFtURVNUX0NBQ0hFRF9ST1VURS5wcm90b2NvbF0sXG4gIGJsb2NrTnVtYmVyOiAwLFxuICB0cmFkZVR5cGU6IFRyYWRlVHlwZS5FWEFDVF9JTlBVVCxcbiAgb3JpZ2luYWxBbW91bnQ6ICcxJyxcbiAgYmxvY2tzVG9MaXZlOiA1LFxufSlcblxuY29uc3QgVEVTVF9DQUNIRURfUk9VVEVfMiA9IG5ldyBDYWNoZWRSb3V0ZSh7IHJvdXRlOiBURVNUX1VTRENfV0VUSF9WM19ST1VURSwgcGVyY2VudDogMTAwIH0pXG5jb25zdCBURVNUX0NBQ0hFRF9ST1VURVNfMiA9IG5ldyBDYWNoZWRSb3V0ZXMoe1xuICByb3V0ZXM6IFtURVNUX0NBQ0hFRF9ST1VURV8yXSxcbiAgY2hhaW5JZDogVEVTVF9DQUNIRURfUk9VVEVfMi5yb3V0ZS5jaGFpbklkLFxuICB0b2tlbkluOiBVU0RDX01BSU5ORVQsXG4gIHRva2VuT3V0OiBXRVRILFxuICBwcm90b2NvbHNDb3ZlcmVkOiBbVEVTVF9DQUNIRURfUk9VVEVfMi5wcm90b2NvbF0sXG4gIGJsb2NrTnVtYmVyOiAwLFxuICB0cmFkZVR5cGU6IFRyYWRlVHlwZS5FWEFDVF9PVVRQVVQsXG4gIG9yaWdpbmFsQW1vdW50OiAnMScsXG4gIGJsb2Nrc1RvTGl2ZTogNSxcbn0pXG5cbmNvbnN0IFRFU1RfVU5DQUNIRURfUk9VVEUgPSBuZXcgQ2FjaGVkUm91dGUoeyByb3V0ZTogVEVTVF9VTklfVVNEQ19ST1VURSwgcGVyY2VudDogMTAwIH0pXG5jb25zdCBURVNUX1VOQ0FDSEVEX1JPVVRFUyA9IG5ldyBDYWNoZWRSb3V0ZXMoe1xuICByb3V0ZXM6IFtURVNUX1VOQ0FDSEVEX1JPVVRFXSxcbiAgY2hhaW5JZDogVEVTVF9VTkNBQ0hFRF9ST1VURS5yb3V0ZS5jaGFpbklkLFxuICB0b2tlbkluOiBVTklfTUFJTk5FVCxcbiAgdG9rZW5PdXQ6IFVTRENfTUFJTk5FVCxcbiAgcHJvdG9jb2xzQ292ZXJlZDogW1RFU1RfVU5DQUNIRURfUk9VVEUucHJvdG9jb2xdLFxuICBibG9ja051bWJlcjogMCxcbiAgdHJhZGVUeXBlOiBUcmFkZVR5cGUuRVhBQ1RfSU5QVVQsXG4gIG9yaWdpbmFsQW1vdW50OiAnMScsXG4gIGJsb2Nrc1RvTGl2ZTogNSxcbn0pXG5cbmRlc2NyaWJlKCdEeW5hbW9Sb3V0ZUNhY2hpbmdQcm92aWRlcicsIGFzeW5jICgpID0+IHtcbiAgc2V0dXBUYWJsZXMoVEVTVF9ST1VURV9UQUJMRSlcbiAgY29uc3QgZHluYW1vUm91dGVDYWNoZSA9IG5ldyBEeW5hbW9Sb3V0ZUNhY2hpbmdQcm92aWRlcih7IGNhY2hlZFJvdXRlc1RhYmxlTmFtZTogVEVTVF9ST1VURV9UQUJMRS5UYWJsZU5hbWUgfSlcblxuICBpdCgnQ2FjaGVzIHJvdXRlcyBwcm9wZXJseSBmb3IgYSB0b2tlbiBwYWlyIHRoYXQgaGFzIGl0cyBjYWNoZSBjb25maWd1cmVkIHRvIExpdmVtb2RlJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGN1cnJlbmN5QW1vdW50ID0gQ3VycmVuY3lBbW91bnQuZnJvbVJhd0Ftb3VudChXRVRILCBKU0JJLkJpZ0ludCgxICogMTAgKiogV0VUSC5kZWNpbWFscykpXG4gICAgY29uc3QgY2FjaGVNb2RlID0gYXdhaXQgZHluYW1vUm91dGVDYWNoZS5nZXRDYWNoZU1vZGUoXG4gICAgICBDaGFpbklkLk1BSU5ORVQsXG4gICAgICBjdXJyZW5jeUFtb3VudCxcbiAgICAgIFVTRENfTUFJTk5FVCxcbiAgICAgIFRyYWRlVHlwZS5FWEFDVF9JTlBVVCxcbiAgICAgIFtQcm90b2NvbC5WM11cbiAgICApXG4gICAgZXhwZWN0KGNhY2hlTW9kZSkudG8uZXF1YWwoQ2FjaGVNb2RlLkxpdmVtb2RlKVxuXG4gICAgY29uc3QgaW5zZXJ0ZWRJbnRvQ2FjaGUgPSBhd2FpdCBkeW5hbW9Sb3V0ZUNhY2hlLnNldENhY2hlZFJvdXRlKFRFU1RfQ0FDSEVEX1JPVVRFUywgY3VycmVuY3lBbW91bnQpXG4gICAgZXhwZWN0KGluc2VydGVkSW50b0NhY2hlKS50by5iZS50cnVlXG5cbiAgICBjb25zdCBjYWNoZU1vZGVGcm9tQ2FjaGVkUm91dGVzID0gYXdhaXQgZHluYW1vUm91dGVDYWNoZS5nZXRDYWNoZU1vZGVGcm9tQ2FjaGVkUm91dGVzKFxuICAgICAgVEVTVF9DQUNIRURfUk9VVEVTLFxuICAgICAgY3VycmVuY3lBbW91bnRcbiAgICApXG4gICAgZXhwZWN0KGNhY2hlTW9kZUZyb21DYWNoZWRSb3V0ZXMpLnRvLmVxdWFsKENhY2hlTW9kZS5MaXZlbW9kZSlcblxuICAgIC8vIEZldGNoZXMgcm91dGUgc3VjY2Vzc2Z1bGx5IGZyb20gY2FjaGUgd2hlbiBpdCBoYXMgYmVlbiBjYWNoZWQuXG4gICAgY29uc3Qgcm91dGUgPSBhd2FpdCBkeW5hbW9Sb3V0ZUNhY2hlLmdldENhY2hlZFJvdXRlKFxuICAgICAgQ2hhaW5JZC5NQUlOTkVULFxuICAgICAgY3VycmVuY3lBbW91bnQsXG4gICAgICBVU0RDX01BSU5ORVQsXG4gICAgICBUcmFkZVR5cGUuRVhBQ1RfSU5QVVQsXG4gICAgICBbUHJvdG9jb2wuVjNdLFxuICAgICAgVEVTVF9DQUNIRURfUk9VVEVTLmJsb2NrTnVtYmVyXG4gICAgKVxuICAgIGV4cGVjdChyb3V0ZSkudG8ubm90LmJlLnVuZGVmaW5lZFxuICB9KVxuXG4gIGl0KCdDYWNoZXMgcm91dGVzIHByb3Blcmx5IGZvciBhIHRva2VuIHBhaXIgdGhhdCBoYXMgaXRzIGNhY2hlIGNvbmZpZ3VyZWQgdG8gVGFwY29tcGFyZScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBjdXJyZW5jeUFtb3VudCA9IEN1cnJlbmN5QW1vdW50LmZyb21SYXdBbW91bnQoV0VUSCwgSlNCSS5CaWdJbnQoMTAwICogMTAgKiogV0VUSC5kZWNpbWFscykpXG4gICAgY29uc3QgY2FjaGVNb2RlID0gYXdhaXQgZHluYW1vUm91dGVDYWNoZS5nZXRDYWNoZU1vZGUoXG4gICAgICBDaGFpbklkLk1BSU5ORVQsXG4gICAgICBjdXJyZW5jeUFtb3VudCxcbiAgICAgIFVTRENfTUFJTk5FVCxcbiAgICAgIFRyYWRlVHlwZS5FWEFDVF9PVVRQVVQsXG4gICAgICBbUHJvdG9jb2wuVjNdXG4gICAgKVxuICAgIGV4cGVjdChjYWNoZU1vZGUpLnRvLmVxdWFsKENhY2hlTW9kZS5UYXBjb21wYXJlKVxuXG4gICAgY29uc3QgaW5zZXJ0ZWRJbnRvQ2FjaGUgPSBhd2FpdCBkeW5hbW9Sb3V0ZUNhY2hlLnNldENhY2hlZFJvdXRlKFRFU1RfQ0FDSEVEX1JPVVRFU18yLCBjdXJyZW5jeUFtb3VudClcbiAgICBleHBlY3QoaW5zZXJ0ZWRJbnRvQ2FjaGUpLnRvLmJlLnRydWVcblxuICAgIGNvbnN0IGNhY2hlTW9kZUZyb21DYWNoZWRSb3V0ZXMgPSBhd2FpdCBkeW5hbW9Sb3V0ZUNhY2hlLmdldENhY2hlTW9kZUZyb21DYWNoZWRSb3V0ZXMoXG4gICAgICBURVNUX0NBQ0hFRF9ST1VURVNfMixcbiAgICAgIGN1cnJlbmN5QW1vdW50XG4gICAgKVxuICAgIGV4cGVjdChjYWNoZU1vZGVGcm9tQ2FjaGVkUm91dGVzKS50by5lcXVhbChDYWNoZU1vZGUuVGFwY29tcGFyZSlcblxuICAgIC8vIEZldGNoZXMgcm91dGUgc3VjY2Vzc2Z1bGx5IGZyb20gY2FjaGUsIHNpbmNlIGNhY2hlIGlzIGFjdGl2ZSBpbiBUYXBjb21wYXJlIG1vZGUuXG4gICAgY29uc3Qgcm91dGUgPSBhd2FpdCBkeW5hbW9Sb3V0ZUNhY2hlLmdldENhY2hlZFJvdXRlKFxuICAgICAgQ2hhaW5JZC5NQUlOTkVULFxuICAgICAgY3VycmVuY3lBbW91bnQsXG4gICAgICBVU0RDX01BSU5ORVQsXG4gICAgICBUcmFkZVR5cGUuRVhBQ1RfT1VUUFVULFxuICAgICAgW1Byb3RvY29sLlYzXSxcbiAgICAgIFRFU1RfQ0FDSEVEX1JPVVRFU18yLmJsb2NrTnVtYmVyXG4gICAgKVxuICAgIGV4cGVjdChyb3V0ZSkudG8ubm90LmJlLnVuZGVmaW5lZFxuICB9KVxuXG4gIGl0KCdEb2VzIG5vdCBjYWNoZSByb3V0ZXMgZm9yIGEgdG9rZW4gcGFpciB0aGF0IGhhcyBpdHMgY2FjaGUgY29uZmlndXJlZCBpbiB0aGUgZGVmYXVsdCBEYXJrbW9kZScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBjdXJyZW5jeUFtb3VudCA9IEN1cnJlbmN5QW1vdW50LmZyb21SYXdBbW91bnQoVU5JX01BSU5ORVQsIEpTQkkuQmlnSW50KDEgKiAxMCAqKiBVTklfTUFJTk5FVC5kZWNpbWFscykpXG4gICAgY29uc3QgY2FjaGVNb2RlID0gYXdhaXQgZHluYW1vUm91dGVDYWNoZS5nZXRDYWNoZU1vZGUoXG4gICAgICBDaGFpbklkLk1BSU5ORVQsXG4gICAgICBjdXJyZW5jeUFtb3VudCxcbiAgICAgIFVTRENfTUFJTk5FVCxcbiAgICAgIFRyYWRlVHlwZS5FWEFDVF9JTlBVVCxcbiAgICAgIFtQcm90b2NvbC5WM11cbiAgICApXG4gICAgZXhwZWN0KGNhY2hlTW9kZSkudG8uZXF1YWwoQ2FjaGVNb2RlLkRhcmttb2RlKVxuXG4gICAgY29uc3QgaW5zZXJ0ZWRJbnRvQ2FjaGUgPSBhd2FpdCBkeW5hbW9Sb3V0ZUNhY2hlLnNldENhY2hlZFJvdXRlKFRFU1RfVU5DQUNIRURfUk9VVEVTLCBjdXJyZW5jeUFtb3VudClcbiAgICBleHBlY3QoaW5zZXJ0ZWRJbnRvQ2FjaGUpLnRvLmJlLmZhbHNlXG5cbiAgICBjb25zdCBjYWNoZU1vZGVGcm9tQ2FjaGVkUm91dGVzID0gYXdhaXQgZHluYW1vUm91dGVDYWNoZS5nZXRDYWNoZU1vZGVGcm9tQ2FjaGVkUm91dGVzKFxuICAgICAgVEVTVF9VTkNBQ0hFRF9ST1VURVMsXG4gICAgICBjdXJyZW5jeUFtb3VudFxuICAgIClcbiAgICBleHBlY3QoY2FjaGVNb2RlRnJvbUNhY2hlZFJvdXRlcykudG8uZXF1YWwoQ2FjaGVNb2RlLkRhcmttb2RlKVxuXG4gICAgLy8gRmV0Y2hlcyBub3RoaW5nIGZyb20gdGhlIGNhY2hlIHNpbmNlIGNhY2hlIGlzIGluIERhcmttb2RlLlxuICAgIGNvbnN0IHJvdXRlID0gYXdhaXQgZHluYW1vUm91dGVDYWNoZS5nZXRDYWNoZWRSb3V0ZShcbiAgICAgIENoYWluSWQuTUFJTk5FVCxcbiAgICAgIGN1cnJlbmN5QW1vdW50LFxuICAgICAgVVNEQ19NQUlOTkVULFxuICAgICAgVHJhZGVUeXBlLkVYQUNUX0lOUFVULFxuICAgICAgW1Byb3RvY29sLlYzXSxcbiAgICAgIFRFU1RfQ0FDSEVEX1JPVVRFUy5ibG9ja051bWJlclxuICAgIClcbiAgICBleHBlY3Qocm91dGUpLnRvLmJlLnVuZGVmaW5lZFxuICB9KVxuXG4gIGl0KCdGaW5kcyB0aGUgQ2FjaGVNb2RlIGZyb20gYSB3aWxkY2FyZCBleGFjdCBvdXRwdXQgY29uZmlndXJhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBjdXJyZW5jeUFtb3VudCA9IEN1cnJlbmN5QW1vdW50LmZyb21SYXdBbW91bnQoV0VUSCwgSlNCSS5CaWdJbnQoMTAwICogMTAgKiogV0VUSC5kZWNpbWFscykpXG4gICAgY29uc3QgY2FjaGVNb2RlID0gYXdhaXQgZHluYW1vUm91dGVDYWNoZS5nZXRDYWNoZU1vZGUoXG4gICAgICBDaGFpbklkLk1BSU5ORVQsXG4gICAgICBjdXJyZW5jeUFtb3VudCxcbiAgICAgIFVTRENfTUFJTk5FVCxcbiAgICAgIFRyYWRlVHlwZS5FWEFDVF9PVVRQVVQsXG4gICAgICBbUHJvdG9jb2wuVjNdXG4gICAgKVxuICAgIGV4cGVjdChjYWNoZU1vZGUpLnRvLmVxdWFsKENhY2hlTW9kZS5UYXBjb21wYXJlKVxuICB9KVxufSlcbiJdfQ==